##Comentarios, comandos

/home/javiersb/.local/share/virtualenvs/asir-deploy_playbook-2fTrB4Tr/bin/python3.10

#Iniciar host remotos
    $ visudo 
    #includedir /etc/sudoers.d
    ansible      ALL=(ALL)       NOPASSWD: ALL

    ## ssh-keygen -N {{password}} -f {{file}}

    ----------## sudo apt install sshpass

    --------sudo nano /etc/ssh/ssh_config
    ------------StrictHostKeyChecking accept-new

    ansible-galaxy install -r requirements.yml -p roles

    En Ansible, las tareas dentro de un rol se ejecutan antes de las tareas definidas fuera de los roles. 
    Esto significa que, en tu playbook, las tareas dentro del rol ssh_copy_id se ejecutarán antes de las tareas definidas bajo el bloque tasks.

    FIXED with pre_tasks

    generate inventory.ini with inventory .j2


# Archivo ansible.cfg muy importante

-errores:
    pdfshuffler
    exfat-utils
    openshot
    kolourpaint4
    openshot openshot-doc
    redshift redshift-gtk
    lshw lshw-gtk

## Creacion tasks user
encriptamos en vault las passwords
# no añadir group al crear user, se crea solo

##errores al crear usuarios
    no añadir encriptacion a las passwords, (linux no sabia detectarlas o yks)
    al añadir los hash, no borrar las carpetas home y habia errores con los .bashrc o .bash_profile o asi que habian en las carpetas de los users

# pasar passwd (al instalar cosas)
    ansible.cfg -> ask_become_pass
    a traves de var en vault - become_pass: "{{ admin_pass }}"

# url españa iso LINUXMINT
    # cinnamon
    https://mirror.airenetworks.es/linuxmint/iso/stable/21/linuxmint-21-cinnamon-64bit.iso
    https://ftp.cixug.es/mint/stable/21/linuxmint-21-cinnamon-64bit.iso
    # mate
    https://mirror.airenetworks.es/linuxmint/iso/stable/21/linuxmint-21-mate-64bit.iso
    https://ftp.cixug.es/mint/stable/21/linuxmint-21-mate-64bit.iso

# url download iso ubuntu server
    http://releases.ubuntu.com/22.04.2/ubuntu-22.04.2-live-server-amd64.iso

# error vboxmanage
ansible-galaxy collection install community.general

# error install snapd
# error install mysql-workbench
# error al crear profesor -- por si esta ya creado cambia la pass
# los paquetes snap no se ven en la interfaz grafica (solved)
# when: result_asir_root_user.rc != 0 -> rc return code 
# error comprobar iso ya descargadas

# error en disk_path: "{{ default_path_vms }}/{{ self.name }}" problema con el loop.

# add collections local
    # ansible-galaxy collection install -r requirements.yml --collections-path ./collections

# ls /usr/bin/veyon*
# /usr/bin/veyon-auth-helper   /usr/bin/veyon-master   /usr/bin/veyon-worker
# /usr/bin/veyon-cli           /usr/bin/veyon-server
# /usr/bin/veyon-configurator  /usr/bin/veyon-service

    # autenticacion - autenticacion mediante archivo de clave

# no puedo añadir que el localhost genere key veyon

# veyon-cli authkeys list
# export - import key
# configure master && slave - keys, backends,defaults
    # sudo veyon-cli authkeys create asir
    # sudo veyon-cli authkeys setaccessgroup asir/public <user in localhost>
    # sudo veyon-cli authkeys setaccessgroup asir/private <user in localhost>
    # veyon-cli authkeys export asir/public (directorio activo)
    # tasks client
# sudo veyon-master

# no instala el jenkins
# download .war jenkins
# java -jar jenkins.war
# copy pass
# localhost:8080

ANSIBLE IN JENKINS
# Panel de Control -> Administrar Jenkins -> Gestor de plugins -> Available Plugins -> Ansible
cd /home/javiersb/workspace/asir-deploy_playbook
pipenv run ansible-playbook main.yml
# /home/javiersb/workspace/asir-deploy_playbook/main.yml

JENKINS
# He ocultado las key ssh para comprobar si funciona con jenkins solo

veyon-cli config set Computers.1.Name Equipo1 && veyon-ctl config set Computers.1.IPAddress 192.168.1.100
veyon-cli config set Computers.2.Name Equipo2 && veyon-ctl config set Computers.2.IPAddress 192.168.1.101






















